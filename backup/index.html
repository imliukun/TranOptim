<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TranOptim - æ™ºèƒ½ç¿»è¯‘ä¸æ¶¦è‰²å·¥å…·</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/chat.css">
    <!-- ç´§æ€¥ä¿®å¤è„šæœ¬ -->
    <script>
        // è®°å½•åˆå§‹åŒ–æ—¶é—´
        window.TranOptimPageLoadTime = new Date().getTime();
        console.log('[åˆå§‹åŒ–] é¡µé¢å¼€å§‹åŠ è½½:', window.TranOptimPageLoadTime);
        
        // æ·»åŠ å…¨å±€é”™è¯¯ç›‘å¬
        window.addEventListener('error', function(event) {
            console.error('[å…¨å±€é”™è¯¯]', event.message, 
                          'ä½ç½®:', event.filename, 
                          'è¡Œ:', event.lineno, 
                          'åˆ—:', event.colno);
        });
        
        // æŒ‰é’®ç‚¹å‡»ä¿åº•å¤„ç†
        document.addEventListener('click', function(e) {
            // æ£€æŸ¥æ˜¯å¦ç‚¹å‡»çš„æ˜¯ç¿»è¯‘æˆ–æ¶¦è‰²æŒ‰é’®
            if (e.target && (
                e.target.id === 'translateBtn' || 
                e.target.closest('#translateBtn') ||
                e.target.id === 'polishBtn' || 
                e.target.closest('#polishBtn')
            )) {
                console.log('[ä¿åº•å¤„ç†] æ£€æµ‹åˆ°æŒ‰é’®ç‚¹å‡»:', 
                    e.target.id || (e.target.closest('button') ? e.target.closest('button').id : 'æœªçŸ¥æŒ‰é’®'));
                
                // ä¸ºæŒ‰é’®æ·»åŠ è§†è§‰åé¦ˆ
                const btn = e.target.closest('button');
                if (btn) {
                    btn.classList.add('active');
                    setTimeout(() => btn.classList.remove('active'), 200);
                }
            }
        }, true); // ä½¿ç”¨æ•è·é˜¶æ®µ
    </script>
    <!-- è®¤è¯é…ç½®å’Œè„šæœ¬ -->
    <script src="auth-config.js"></script>
    <script src="js/auth.js"></script>
    <!-- Cloudflareéƒ¨ç½²é…ç½® -->
    <script src="cloudflare-config.js"></script>
</head>
<body>
    <div class="container">
        <div class="main-content">
            <!-- ä¾§è¾¹æ  -->
            <div class="sidebar">
                <div class="sidebar-header">
                    <h2>TranOptim</h2>
                    <div class="sidebar-actions">
                        <button class="new-chat-btn" id="newChatBtn" onclick="console.log('æ–°å¯¹è¯æŒ‰é’®ç‚¹å‡»'); alert('åˆ›å»ºæ–°å¯¹è¯'); return false;">
                            <i class="fas fa-plus"></i> æ–°å¯¹è¯
                        </button>
                        <button class="clear-chats-btn" id="clearChatsBtn" onclick="console.log('æ¸…ç©ºå¯¹è¯æŒ‰é’®ç‚¹å‡»'); if(confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å¯¹è¯è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) { alert('å·²æ¸…ç©ºæ‰€æœ‰å¯¹è¯'); } return false;">
                            <i class="fas fa-trash"></i> æ¸…ç©º
                        </button>
                    </div>
                </div>
                <div class="conversation-list" id="conversationList">
                    <!-- å¯¹è¯åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <!-- ç”¨æˆ·ä¿¡æ¯å’Œé€€å‡ºæŒ‰é’® -->
                <div class="user-info" id="userInfo">
                    <div class="user-avatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="user-name" id="userName"></div>
                    <button class="logout-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> é€€å‡º
                    </button>
                </div>
            </div>

            <!-- èŠå¤©åŒºåŸŸ -->
            <div class="chat-container">
                <div class="chat-header">
                    <div class="app-title">TranOptim æ™ºèƒ½ç¿»è¯‘ä¸æ¶¦è‰²å·¥å…·</div>
                    <div class="global-actions">
                        <!-- å·²ç§»é™¤APIå¯†é’¥å’Œç½‘ç»œä»£ç†æŒ‰é’® -->
                    </div>
                </div>

                <div class="chat-messages" id="chatMessages">
                    <!-- æ¬¢è¿æ¶ˆæ¯ -->
                    <div class="message system">
                        <div class="message-content">
                            <p>ğŸ‘‹ æ¬¢è¿ä½¿ç”¨ TranOptim æ™ºèƒ½ç¿»è¯‘ä¸æ¶¦è‰²å·¥å…·ï¼</p>
                            <p>æ‚¨å¯ä»¥ç›´æ¥è¾“å…¥æ–‡æœ¬è¿›è¡Œç¿»è¯‘ï¼Œæˆ–è€…ä¸Šä¼ å›¾ç‰‡è¿›è¡Œå›¾åƒæ–‡æœ¬ç¿»è¯‘ã€‚</p>
                        </div>
                    </div>
                </div>

                <!-- è¾“å…¥åŒºåŸŸ -->
                <div class="chat-input-area">
                    <div class="input-wrapper">
                        <div class="input-container">
                            <div class="textarea-wrapper">
                                <textarea id="chatInput" class="chat-input" placeholder="è¾“å…¥æ–‡æœ¬æˆ–ä¸Šä¼ å›¾ç‰‡..." rows="1"></textarea>
                            </div>
                            <div class="buttons-wrapper">
                                <div class="action-buttons">
                                    <button class="btn upload-btn" id="uploadBtn" onclick="console.log('å›¾ç‰‡æŒ‰é’®ç‚¹å‡»'); document.getElementById('imageUpload').click(); return false;">
                                        <i class="fas fa-image"></i> å›¾ç‰‡
                                    </button>
                                    <input type="file" id="imageUpload" class="image-upload" accept="image/*">
                                    <button class="btn primary-btn" id="translateBtn" onclick="console.log('ç¿»è¯‘æŒ‰é’®ç‚¹å‡»'); alert('ç¿»è¯‘æŒ‰é’®è¢«ç‚¹å‡»'); return false;">
                                        <i class="fas fa-language"></i> ç¿»è¯‘
                                    </button>
                                    <button class="btn secondary-btn" id="polishBtn" onclick="console.log('æ¶¦è‰²æŒ‰é’®ç‚¹å‡»'); alert('æ¶¦è‰²æŒ‰é’®è¢«ç‚¹å‡»'); return false;">
                                        <i class="fas fa-magic"></i> æ¶¦è‰²
                                    </button>
                                </div>
                                <div class="settings-buttons">
                                    <button class="settings-btn" id="translateSettingsBtn" onclick="toggleSettingsPanel('translateSettings'); return false;">
                                        <i class="fas fa-cog"></i>
                                    </button>
                                    <button class="settings-btn" id="polishSettingsBtn" onclick="toggleSettingsPanel('polishSettings'); return false;">
                                        <i class="fas fa-sliders-h"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ç¿»è¯‘è®¾ç½®é¢æ¿ -->
                <div class="settings-panel" id="translateSettings">
                    <h3>
                        ç¿»è¯‘è®¾ç½®
                        <button class="close-settings-btn" id="closeTranslateSettings" onclick="document.getElementById('translateSettings').classList.remove('active'); return false;">
                            <i class="fas fa-times"></i>
                        </button>
                    </h3>
                    <div class="settings-group">
                        <span class="settings-label">ç¿»è¯‘æœåŠ¡</span>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="gpt" name="translate-service" value="gpt" checked>
                                <label for="gpt">ChatGPT</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="gemini" name="translate-service" value="gemini">
                                <label for="gemini">Gemini</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="deepseek" name="translate-service" value="deepseek">
                                <label for="deepseek">DeepSeek</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="qwen" name="translate-service" value="qwen">
                                <label for="qwen">Qwen</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="doubao" name="translate-service" value="doubao">
                                <label for="doubao">è±†åŒ…</label>
                            </div>
                        </div>
                    </div>
                    <div class="settings-group">
                        <span class="settings-label">æºè¯­è¨€</span>
                        <select id="sourceLanguage">
                            <option value="auto">è‡ªåŠ¨æ£€æµ‹</option>
                            <option value="zh">ä¸­æ–‡</option>
                            <option value="en">è‹±æ–‡</option>
                            <option value="ja">æ—¥æ–‡</option>
                            <option value="ko">éŸ©æ–‡</option>
                            <option value="fr">æ³•æ–‡</option>
                            <option value="de">å¾·æ–‡</option>
                            <option value="es">è¥¿ç­ç‰™æ–‡</option>
                            <option value="it">æ„å¤§åˆ©æ–‡</option>
                            <option value="ru">ä¿„æ–‡</option>
                        </select>
                    </div>
                    <div class="settings-group">
                        <span class="settings-label">ç›®æ ‡è¯­è¨€</span>
                        <select id="targetLanguage">
                            <option value="zh">ä¸­æ–‡</option>
                            <option value="en">è‹±æ–‡</option>
                            <option value="ja">æ—¥æ–‡</option>
                            <option value="ko">éŸ©æ–‡</option>
                            <option value="fr">æ³•æ–‡</option>
                            <option value="de">å¾·æ–‡</option>
                            <option value="es">è¥¿ç­ç‰™æ–‡</option>
                            <option value="it">æ„å¤§åˆ©æ–‡</option>
                            <option value="ru">ä¿„æ–‡</option>
                        </select>
                    </div>
                </div>

                <!-- æ¶¦è‰²è®¾ç½®é¢æ¿ -->
                <div class="settings-panel" id="polishSettings">
                    <h3>
                        æ¶¦è‰²è®¾ç½®
                        <button class="close-settings-btn" id="closePolishSettings" onclick="document.getElementById('polishSettings').classList.remove('active'); return false;">
                            <i class="fas fa-times"></i>
                        </button>
                    </h3>
                    <div class="settings-group">
                        <span class="settings-label">æ¶¦è‰²æœåŠ¡</span>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="polishGpt" name="polish-service" value="gpt" checked>
                                <label for="polishGpt">ChatGPT</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="polishGemini" name="polish-service" value="gemini">
                                <label for="polishGemini">Gemini</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="polishDeepseek" name="polish-service" value="deepseek">
                                <label for="polishDeepseek">DeepSeek</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="polishQwen" name="polish-service" value="qwen">
                                <label for="polishQwen">Qwen</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="polishDoubao" name="polish-service" value="doubao">
                                <label for="polishDoubao">è±†åŒ…</label>
                            </div>
                        </div>
                    </div>
                    <div class="settings-group">
                        <span class="settings-label">æ¶¦è‰²é£æ ¼</span>
                        <select id="polishStyle">
                            <option value="professional">ä¸“ä¸šæ­£å¼</option>
                            <option value="simple">ç®€æ´æ˜äº†</option>
                            <option value="creative">åˆ›æ„æ´»æ³¼</option>
                            <option value="academic">å­¦æœ¯ä¸¥è°¨</option>
                            <option value="normal">è‡ªç„¶æµç•…</option>
                            <option value="rephrase">é‡æ–°è¡¨è¿°</option>
                        </select>
                    </div>
                    <div class="settings-group">
                        <span class="settings-label">æ¶¦è‰²æ–¹å¼</span>
                        <div class="polish-description">
                            <p>ç‚¹å‡»æ¶¦è‰²åï¼Œç³»ç»Ÿå°†è‡ªåŠ¨ç”Ÿæˆä¸¤ç§é£æ ¼çš„æ¶¦è‰²ç»“æœï¼š</p>
                            <p><strong>1. å¸¸è§„ä¼˜åŒ–</strong>ï¼šæ¶¦è‰²è¯­å¥ä½¿ä¹‹æ›´é€‚åˆå›¾ä¹¦å‡ºç‰ˆï¼Œé€šä¿—æ˜“æ‡‚ï¼Œæœ—æœ—ä¸Šå£ï¼Œç¬¦åˆä¸­æ–‡è¡¨è¾¾ä¹ æƒ¯</p>
                            <p><strong>2. è½¬æ¢è¯­è¨€é£æ ¼</strong>ï¼šåˆ©ç”¨è¿‘ä¹‰è¯ã€æ”¹å˜è¯­å¥ç»“æ„ã€æ”¹å˜ä¸»è¯­ã€åè¯‘ç­‰æ–¹å¼é‡æ–°è¡¨è¿°</p>
                        </div>
                    </div>
                    <div class="settings-group">
                        <span class="settings-label">è§’è‰²è®¾å®š</span>
                        <div class="role-description">
                            <p>æ¶¦è‰²è€…å°†æ‰®æ¼”å›¾ä¹¦ä½œå®¶çš„è§’è‰²ï¼Œä¸“æ³¨äºæ–‡æœ¬æ¶¦è‰²ï¼Œä¸ä¼šé¢å¤–æ·»åŠ æ–‡ä¸­æ²¡æœ‰çš„å†…å®¹</p>
                        </div>
                    </div>
                    <div class="settings-group">
                        <span class="settings-label">è¯­è¨€</span>
                        <select id="polishLanguage">
                            <option value="zh">ä¸­æ–‡</option>
                            <option value="en">è‹±æ–‡</option>
                            <option value="ja">æ—¥æ–‡</option>
                            <option value="ko">éŸ©æ–‡</option>
                            <option value="fr">æ³•æ–‡</option>
                            <option value="de">å¾·æ–‡</option>
                            <option value="es">è¥¿ç­ç‰™æ–‡</option>
                            <option value="it">æ„å¤§åˆ©æ–‡</option>
                            <option value="ru">ä¿„æ–‡</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- åŠ è½½è¦†ç›–å±‚ -->
    <div class="loading-overlay hidden" id="loadingOverlay">
        <div class="spinner"></div>
        <div class="loading-text" id="loadingText">æ­£åœ¨ç¿»è¯‘ä¸­...</div>
        <div class="loading-timeout-hint" id="loadingTimeoutHint">
            å¦‚æœåŠ è½½æ—¶é—´è¿‡é•¿ï¼Œè¯·<a href="javascript:void(0)" onclick="window.location.reload()">åˆ·æ–°é¡µé¢</a>é‡è¯•
        </div>
    </div>

    <!-- é€šçŸ¥ç»„ä»¶ -->
    <div class="notification" id="notification"></div>

    <!-- åº”ç”¨è„šæœ¬ - æŒ‰é¡ºåºåŠ è½½ -->
    <script src="js/app.js"></script>
    <script src="js/chat.js"></script>
    <!-- æ·»åŠ ç´§æ€¥ä¿®å¤è„šæœ¬ -->
    <script src="js/buttons-fix.js"></script>
    <!-- æ·»åŠ è®¾ç½®é¢æ¿ä¸“é—¨ä¿®å¤è„šæœ¬ -->
    <script src="js/settings-fix.js"></script>
    
    <!-- å¢åŠ å†…è”æŒ‰é’®äº‹ä»¶ä½œä¸ºæœ€åçš„å¤‡ä»½ -->
    <script>
        // é¡µé¢å®Œå…¨åŠ è½½åçš„æœ€åä¸€é“ä¿éšœ
        window.addEventListener('load', function() {
            console.log('[å†…è”è„šæœ¬] é¡µé¢å®Œå…¨åŠ è½½ï¼Œå°è¯•æ·»åŠ å†…è”æŒ‰é’®äº‹ä»¶');
            
            const translateBtn = document.getElementById('translateBtn');
            const polishBtn = document.getElementById('polishBtn');
            
            // ä½¿ç”¨å†…è”æ–¹å¼æ·»åŠ äº‹ä»¶
            if (translateBtn) {
                translateBtn.setAttribute('onclick', "console.log('[å†…è”] ç¿»è¯‘æŒ‰é’®ç‚¹å‡»'); alert('ç¿»è¯‘æŒ‰é’®è¢«ç‚¹å‡»(å†…è”)'); return false;");
            }
            
            if (polishBtn) {
                polishBtn.setAttribute('onclick', "console.log('[å†…è”] æ¶¦è‰²æŒ‰é’®ç‚¹å‡»'); alert('æ¶¦è‰²æŒ‰é’®è¢«ç‚¹å‡»(å†…è”)'); return false;");
            }
        });
    </script>
    
    <!-- è®¤è¯åˆå§‹æ£€æŸ¥è„šæœ¬ -->
    <script>
        // é¡µé¢åŠ è½½å®Œæˆåè¿›è¡Œè®¤è¯æ£€æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            // æ‰§è¡Œè®¤è¯æ£€æŸ¥
            if (window.AuthManager) {
                window.AuthManager.initAuthCheck();
                
                // æ˜¾ç¤ºå½“å‰ç”¨æˆ·å
                const userName = document.getElementById('userName');
                if (userName) {
                    userName.textContent = window.AuthManager.getCurrentUsername() || 'Guest';
                }
                
                // ä¸ºé€€å‡ºæŒ‰é’®æ·»åŠ äº‹ä»¶å¤„ç†å™¨
                const logoutBtn = document.getElementById('logoutBtn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', function() {
                        window.AuthManager.logout();
                    });
                }
            }
        });
    </script>
    
    <!-- ç›´æ¥çš„è®¾ç½®é¢æ¿å‡½æ•°ï¼Œç¡®ä¿å³ä½¿å…¶ä»–è„šæœ¬éƒ½ä¸åŠ è½½ï¼Œè¿™ä¸ªå‡½æ•°ä¹Ÿèƒ½ç”¨ -->
    <script>
        // å…¨å±€å‡½æ•°ï¼šåˆ‡æ¢è®¾ç½®é¢æ¿
        function toggleSettingsPanel(panelId) {
            console.log('æ­£åœ¨æ‰‹åŠ¨åˆ‡æ¢è®¾ç½®é¢æ¿:', panelId);
            
            // è·å–æ‰€æœ‰è®¾ç½®é¢æ¿
            var allPanels = document.querySelectorAll('.settings-panel');
            
            // è·å–è¦åˆ‡æ¢çš„é¢æ¿
            var targetPanel = document.getElementById(panelId);
            
            if (!targetPanel) {
                console.error('æ‰¾ä¸åˆ°æŒ‡å®šçš„é¢æ¿:', panelId);
                return;
            }
            
            // å¦‚æœç›®æ ‡é¢æ¿å½“å‰æ˜¯æ˜¾ç¤ºçŠ¶æ€ï¼Œåˆ™éšè—
            if (targetPanel.classList.contains('active')) {
                targetPanel.classList.remove('active');
            }
            // å¦åˆ™æ˜¾ç¤ºç›®æ ‡é¢æ¿ï¼Œéšè—å…¶ä»–é¢æ¿
            else {
                // å…ˆéšè—æ‰€æœ‰é¢æ¿
                allPanels.forEach(function(panel) {
                    panel.classList.remove('active');
                });
                
                // ç„¶åæ˜¾ç¤ºç›®æ ‡é¢æ¿
                targetPanel.classList.add('active');
            }
        }
    </script>
</body>
</html>